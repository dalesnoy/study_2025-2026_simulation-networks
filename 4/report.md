---
title: "Отчет по лабораторной работе №3 Дисциплина: Моделирование сетей передачи данных"
author: |
  Леснухин Даниил Дмитриевич  
  Российский университет дружбы народов  
  Москва
date: ""
lang: ru
fontsize: 12pt
geometry: margin=2cm
header-includes:
  - \usepackage{fontspec}
  - \setmainfont{Times New Roman}
  - \usepackage{graphicx}
  - \usepackage{float}
---
# Цель работы

Основной целью работы является знакомство с NETEM — инструментом для тестирования производительности приложений в виртуальной сети, а также получение навыков проведения интерактивного и воспроизводимого экспериментов по измерению задержки и её дрожания (jitter) в моделируемой сети в среде Mininet.

# Задание

1. Задайте простейшую топологию, состоящую из двух хостов и коммутатора с назначенной по умолчанию mininet сетью 10.0.0.0/8.
2. Проведите интерактивные эксперименты по добавлению/изменению задержки, джиттера, значения корреляции для джиттера и задержки, распределения времени задержки в эмулируемой глобальной сети.
3. Реализуйте воспроизводимый эксперимент по заданию значения задержки в эмулируемой глобальной сети. Постройте график.
4. Самостоятельно реализуйте воспроизводимые эксперименты по изменению задержки, джиттера, значения корреляции для джиттера и задержки, распределения времени задержки в эмулируемой глобальной сети. Постройте графики.

# Теоретическое введение

Mininet[@mininet] -- это эмулятор компьютерной сети. Под компьютерной сетью подразумеваются простые компьютеры — хосты, коммутаторы, а так же OpenFlow-контроллеры. С помощью простейшего синтаксиса в примитивном интерпретаторе команд можно разворачивать сети из произвольного количества хостов, коммутаторов в различных топологиях и все это в рамках одной виртуальной машины(ВМ). На всех хостах можно изменять сетевую конфигурацию, пользоваться стандартными утилитами(ifconfig, ping) и даже получать доступ к терминалу. На коммутаторы можно добавлять различные правила и маршрутизировать трафик.

# Выполнение лабораторной работы

## Запуск лабораторной топологии

Запустим виртуальную среду с mininet. Из основной ОС подключимся к виртуальной машине. В виртуальной машине mininet при необходимости исправим права запуска X-соединения. Скопируем значение куки (MIT magic cookie) своего пользователя mininet в файл для пользователя root.

![Копируем значения куки](1.png)

Зададим простейшую топологию, состоящую из двух хостов и коммутатора с назначенной по умолчанию mininet сетью 10.0.0.0/8

На хостах h1 и h2 введем команду ifconfig, чтобы отобразить информацию, относящуюся к их сетевым интерфейсам и назначенным им IP-адресам. В дальнейшем при работе с NETEM и командой tc будут использоваться интерфейсы h1-eth0 и h2-eth0

![Простейшая топология два хоста](2.png)

Проверим подключение между хостами h1 и h2 с помощью команды ping с параметром -c 6
![Проверка подключения между хостами](3.png)


## Интерактивные эксперименты

### Добавление/изменение задержки в эмулируемой глобальной сети

Сетевые эмуляторы задают задержки на интерфейсе. Например, задержка, вносимая в интерфейс коммутатора A, который подключён к интерфейсу коммутатора B, может представлять собой задержку распространения WAN, соединяющей оба коммутатора.

На хосте h1 добавим задержку в 100 мс к выходному интерфейсу.

`sudo tc qdisc add dev h1-eth0 root netem delay 100ms`

- sudo: выполнить команду с более высокими привилегиями;
- tc: вызвать управление трафиком Linux;
- qdisc: изменить дисциплину очередей сетевого планировщика;
- add: создать новое правило;
- dev h1-eth0: указать интерфейс, на котором будет применяться правило;
- netem: использовать эмулятор сети;
- delay 100ms: задержка ввода 100 мс.

Проверим, что соединение от хоста h1 к хосту h2 имеет задержку 100 мс, используя команду ping с параметром -c 6 с хоста h1

![Установка задержки 100ms](4.png)


![Проверка задержки 100ms ](5.png)

Для эмуляции глобальной сети с двунаправленной задержкой необходимо к соответствующему интерфейсу на хосте h2 также добавим задержку в 100 миллисекунд.

Проверим, что соединение между хостом h1 и хостом h2 имеет RTT в 200 мс (100 мс от хоста h1 к хосту h2 и 100 мс от хоста h2 к хосту h1), повторив команду ping с параметром -c 6 на терминале хоста h1. Минимальное - (202.068), среднее - (202.884), максимальное - (204.777), стандартное отклонение времени (0.943) приема-передачи.

![Проверка задержки 200ms ](6.png)

### Изменение задержки в эмулируемой глобальной сети

Изменим задержку со 100 мс до 50 мс для отправителя h1 и для получателя h2

Проверим, что соединение от хоста h1 к хосту h2 имеет задержку 100 мс, используя команду ping с параметром -c 6 с терминала хоста h1. Минимальное - (101.050), среднее - (101.253), максимальное - (108.223), стандартное отклонение времени (2.475) приема-передачи.

![Проверка задержки 100ms 2 x 50ms]](7.png)

### Восстановление исходных значений (удаление правил) задержки в эмулируемой глобальной сети

Восстановим конфигурацию по умолчанию, удалив все правила, применённые к сетевому планировщику соответствующего интерфейса. Для отправителя h1: `sudo tc qdisc del dev h1-eth0 root netem`. Для получателя h2: `sudo tc qdisc del dev h2-eth0 root netem`. Проверим, что соединение между хостом h1 и хостом h2 не имеет явно установленной задержки, используя команду ping с параметром -c 6 с терминала хоста h1. Минимальное - (0.145), среднее - (1.256), максимальное - (4.875), стандартное отклонение времени (1.655) приема-передачи.

![Восстановление значений по умолчанию](8.png)

### Добавление значения дрожания задержки в интерфейс подключения к эмулируемой глобальной сети

Добавим на узле h1 задержку в 100 мс со случайным отклонением 10 мс. Проверим, что соединение от хоста h1 к хосту h2 имеет задержку 100 мс со случайным отклонением ±10 мс, используя в терминале хоста h1 команду ping с параметром -c 6. Восстановим конфигурацию интерфейса по умолчанию на узле h1. Минимальное - (91.961), среднее - (99.758), максимальное - (106.319), стандартное отклонение времени (5.130) приема-передачи

![Добавление значения дрожания задержки в интерфейс подключения](9.png)


### Добавление значения корреляции для джиттера и задержки в интерфейс подключения к эмулируемой глобальной сети

Добавим на интерфейсе хоста h1 задержку в 100 мс с вариацией ±10 мс и значением корреляции в 25%. Убедимся, что все пакеты, покидающие устройство h1 на интерфейсе h1-eth0, будут иметь время задержки 100 мс со случайным отклонением ±10 мс, при этом время передачи следующего пакета зависит от предыдущего значения на 25%. Используем для этого в терминале хоста h1 команду ping с параметром -c 20. Восстановим конфигурацию интерфейса по умолчанию на узле h1. Минимальное - (91.887), среднее - (102.565), максимальное - (111.050), стандартное отклонение времени (5.730) приема-передачи

![Добавление значения корреляции для джиттера и задержки в интерфейс подключения](10.png)

Распределение задержки в интерфейсе подключения к эмулируемой глобальной сети

Зададим нормальное распределение задержки на узле h1 в эмулируемой сети. Убедимся, что все пакеты, покидающие хост h1 на интерфейсе h1-eth0, будут иметь время задержки, которое распределено в диапазоне 100 мс ±20 мс. Используем для этого команду ping на терминале хоста h1 с параметром -c 10. Восстановим конфигурацию интерфейса по умолчанию на узле h1. Минимальное - (74.585), среднее - (105.367), максимальное - (126.328), стандартное отклонение времени (16.340) приема-передачи. Завершим работу mininet в интерактивном режиме

![Распределение задержки в интерфейсе подключения](11.png)

## Воспроизведение экспериментов

### Предварительная подготовка

Обновим репозитории программного обеспечения на виртуальной машине: `sudo apt-get update`. Установим пакет geeqie — понадобится для просмотра файлов png: `sudo apt install geeqie`.

Для каждого воспроизводимого эксперимента expname создадим свой каталог, в котором будут размещаться файлы эксперимента: `mkdir -p ~/work/lab_netem_i/expname`. Здесь expname может принимать значения simple-delay, change-delay,
jitter-delay, correlation-delay и т.п. Для каждого случая создадим скрипт для проведения эксперимента lab_netem_i.py и скрипт для визуализации результатов ping_plot.

### Добавление задержки для интерфейса, подключающегося к эмулируемой глобальной сети

С помощью API Mininet воспроизведем эксперимент по добавлению задержки для интерфейса хоста, подключающегося к эмулируемой глобальной сети.

В виртуальной среде mininet в своём рабочем каталоге с проектами создадим каталог simple-delay и перейдем в него.

`mkdir -p ~/work/lab_netem_i/simple-delay cd ~/work/lab_netem_i/simple-delay`


Создадим скрипт для эксперимента lab_netem_i.py.

![Изменение скрипта](13.png)




Создадим скрипт для визуализации ping_plot результатов эксперимента
![Скрипт для визуализации ping_plot](15.png)


Зададим права доступа к файлу скрипта: `chmod +x ping_plot`

![Создание каталогов, права к файлу скрипта](16.png)


Выполним эксперимент. Продемонстрируем построенный в результате выполнения скриптов график

![Результат выполнения скрипта](17.png)


Из файла ping.dat удалим первую строку и заново постройте график. Продемонстрируем построенный в результате график
![Результат выполнения скрипта](18.png)


Разработаем скрипт для вычисления на основе данных файла ping.dat минимального, среднего, максимального и стандартного отклонения времени приёма-передачи
![Cкрипт rtt.py](19.png)

# Выводы

В результате выполнения данной лабораторной работы я познакомился с NETEM -- инструментом для тестирования производительности приложений в виртуальной сети, а также получил навыки проведения интерактивного и воспроизводимого экспериментов по измерению задержки и её дрожания (jitter) в моделируемой сети в среде Mininet.

